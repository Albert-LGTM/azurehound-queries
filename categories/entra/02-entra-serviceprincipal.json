
{
    "name": "Find all Service Principals with an assigned Entra ID role",
    "category": "Entra ID - Service Principals / Managed Identities",
    "queryList": [
        {
            "final": true,
            "query": "MATCH p = (m:AZServicePrincipal)-[r:AZHasRole]->(n:AZRole) RETURN p"
        }
    ]
}
{
    "name": "Find all Service Principals with AZMGGrantAppRoles (direct path to GA)",
    "category": "Entra ID - Service Principals / Managed Identities",
    "queryList": [
        {
            "final": true,
            "query": "MATCH p = (n)-[r:AZMGGrantAppRoles]->(o:AZTenant) RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find all Service Principals with sensitive Application permissions",
    "category": "Entra ID - Service Principals / Managed Identities",
    "queryList": [
        {
            "final": true,
            "query": "MATCH p = (m:AZServicePrincipal)-[r:AZMGAppRoleAssignment_ReadWrite_All|AZMGApplication_ReadWrite_All|AZMGDirectory_ReadWrite_All|AZMGGroupMember_ReadWrite_All|AZMGGroup_ReadWrite_All|AZMGRoleManagement_ReadWrite_Directory|AZMGServicePrincipalEndpoint_ReadWrite_All]->(n:AZServicePrincipal) RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find all direct Controllers of Microsoft Graph",
    "category": "Entra ID - Service Principals / Managed Identities",
    "queryList": [
        {
            "final": true,
            "query": "MATCH p = (n)-[r:AZAddOwner|AZAddSecret|AZAppAdmin|AZCloudAppAdmin|AZMGAddOwner|AZMGAddSecret|AZOwns]->(g:AZServicePrincipal {appdisplayname: \"Microsoft Graph\"}) RETURN p",
            "allowCollapse": true
        }
    ]
}