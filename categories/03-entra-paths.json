{
    "name": "Find all Entra ID Users with a Path to High Value Targets",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (m:AZUser),(n {highvalue:true}),p=shortestPath((m)-[r*1..]->(n)) WHERE NONE (r IN relationships(p) WHERE type(r)= \"GetChanges\") AND NONE (r in relationships(p) WHERE type(r)=\"GetChangesAll\") AND NOT m=n RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find all Entra ID users synchronized from on-prem AD with a Path to High Value Targets",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (m:AZUser WHERE m.onpremisesyncenabled = true),(n {highvalue:true}),p=shortestPath((m)-[r*1..]->(n)) WHERE NONE (r IN relationships(p) WHERE type(r)= \"GetChanges\") AND NONE (r in relationships(p) WHERE type(r)=\"GetChangesAll\") AND NOT m=n RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find shortest Paths to High Value Entra ID Roles",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (n:AZRole WHERE n.displayname =~ '(?i)Global Administrator|Privileged Role Administrator|Privileged Authentication Administrator|Application Administrator|Cloud Application Administrator|User Administrator|Authentication Policy Administrator|Exchange Administrator|Helpdesk Administrator|Sharepoint Administrator|Azure DevOps Administrator'), (m), p=shortestPath((m)-[r*1..]->(n)) WHERE NOT m=n RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find shortest Paths to MS Graph",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (n) WHERE NOT n.displayname=\"Microsoft Graph\" WITH n MATCH p = shortestPath((n)-[r*1..]->(g:AZServicePrincipal {appdisplayname: \"Microsoft Graph\"})) WHERE n<>g RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find Entra ID Applications with Paths to High Value Targets",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (m:AZApp),(n {highvalue:true}),p=shortestPath((m)-[r*1..]->(n)) WHERE NONE (r IN relationships(p) WHERE type(r)= \"GetChanges\") AND NONE (r in relationships(p) WHERE type(r)=\"GetChangesAll\") AND NOT m=n RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find shortest Paths from Owned Users to Service Principals",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (u:AZUser {owned: true}), (m:AZServicePrincipal) MATCH p = shortestPath((u)-[*..]->(m)) RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find shortest Paths from Owned Users to Managed Identities",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (u:AZUser {owned: true}), (m:AZServicePrincipal {serviceprincipaltype: 'ManagedIdentity'}) MATCH p = shortestPath((u)-[*..]->(m)) RETURN p",
            "allowCollapse": true
        }
    ]
}
{
    "name": "Find shortest Paths from all Users to Managed Identities",
    "category": "Entra ID - Paths",
    "queryList": [
        {
            "final": true,
            "query": "MATCH (u:AZUser), (m:AZServicePrincipal {serviceprincipaltype: 'ManagedIdentity'}) MATCH p = shortestPath((u)-[*..]->(m)) RETURN p",
            "allowCollapse": true
        }
    ]
}